<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ourecipe</title>
    <link rel="shortcut icon" href="images/fevicon.png" type="image/x-icon" />
    <link rel="stylesheet" type="text/css" href="css/bootstrap.css" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-nice-select/1.1.0/css/nice-select.min.css" />
    <link href="css/font-awesome.min.css" rel="stylesheet" />
    <link href="css/style.css" rel="stylesheet" />
    <link href="css/responsive.css" rel="stylesheet" />
</head>

<body>
    <!-- 배경 -->
    <div class="hero_area">
        <div class="hero_bg_box">
            <img src="images/hero-bg.jpg" alt="" />
        </div>

        <!-- header section starts -->
        <header class="header_section">
            <nav class="navbar navbar-expand-lg custom_nav-container">
                <a class="navbar-brand" href="index.html"> Ourecipe </a>

                <!-- 검색 및 로그인 영역 -->
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                    <span class=""> </span>
                </button>
                <ul class="navbar-nav">
                    <div class="navbar-collapse" id="navbarSupportedContent">
                        <form class="form-inline justify-content-center" style="flex-grow: 1">
                            <button class="btn my-2 my-sm-0 nav_search-btn" type="submit">
                                <i class="fa fa-search" aria-hidden="true"></i>
                            </button>

                            <div class="form-row">
                                <div class="form-group col-lg-6">
                                    <input type="text" class="form-control" id="foodInput" placeholder="음식을 입력해 주세요." />
                                </div>

                                <div class="form-group col-lg-6">
                                    <select name="" id="timeSelect" class="form-control wide">
                                        <option value="">조리시간 선택</option>
                                        <option value="5분">5분</option>
                                        <option value="10분">10분</option>
                                        <option value="15분">15분</option>
                                        <option value="20분">20분</option>
                                        <option value="30분">30분</option>
                                        <option value="1시간">1시간</option>
                                    </select>
                                    <select name="" id="categorySelect" class="form-control wide">
                                        <option value="">카테고리 선택</option>
                                        <option value="한식">한식</option>
                                        <option value="중식">중식</option>
                                        <option value="일식">일식</option>
                                        <option value="양식">양식</option>
                                    </select>
                                </div>
                            </div>
                        </form>
                    </div>

                    <!-- Login Modal -->
                    <!-- 로그인 버튼 -->
                    <button class="btn nav-link login-button" type="button" id="loginBtn">
                        <i class="fa fa-user" aria-hidden="true"></i> Login
                    </button>

                    <!-- 로그인 모달 -->
                    <div id="loginModal" class="modal">
                        <div class="modal-content">
                            <span class="close">&times;</span>
                            <form id="loginForm">
                                <label for="username">ID:</label>
                                <input type="text" id="username" name="username" placeholder="아이디 입력" />
                                <label for="password">PW:</label>
                                <input type="password" id="password" name="password" placeholder="비밀번호 입력" />
                                <button type="submit" class="login-submit-btn">Login</button>
                            </form>
                            <div class="register-link">
                                <a href="#" id="registerLink">회원가입</a>
                            </div>
                        </div>
                    </div>

                    <!-- 회원가입 모달 -->
                    <div id="registerModal" class="modal">
                        <div class="modal-content">
                            <span class="close-register">&times;</span>
                            <form id="registerForm" action="/register" method="post">
                                <label for="student-id">학번:</label>
                                <input type="number" id="student-id" name="studentId" placeholder="학번 입력" />
                                <label for="name">이름:</label>
                                <input type="text" id="name" name="name" placeholder="이름 입력" />
                                <label for="new-username">등록할 ID:</label>
                                <input type="text" id="new-username" name="username" placeholder="ID 입력" />
                                <label for="new-password">등록할 비밀번호:</label>
                                <input type="password" id="new-password" name="password" placeholder="비밀번호 입력" />
                                <button type="submit" class="register-submit-btn">Register</button>
                                <div id="error-message"></div>
                            </form>
                        </div>
                    </div>
                    <!-- 경고 모달 -->
                    <div id="warningModal" class="modal" style="display: none;">
                        <div class="modal-content">
                        <span class="warning-close">&times;</span>
                        <p id="warning-text"></p>
                        </div>
                    </div>
                    
                    <!-- 회원가입 완료 모달 -->
                    <div id="successModal" class="modal" style="display: none;">
                        <div class="modal-content">
                        <span class="success-close">&times;</span>
                        <p>회원가입이 완료되었습니다!</p>
                        </div>
                    </div>
                </ul>
            </nav>
            <!-- 마이페이지 모달 -->
            <div id="myPageModal" class="modal">
                <div class="myPage-modal-content">
                    <div class="myPage-modal-header">
                        <span class="close-mypage">&times;</span>
                        <h2 id="myPageUsername">마이페이지</h2>
                    </div>
                    <div class="myPage-modal-body">
                        <div id="userInfo" class="myPage-section">
                            <h3>회원 정보</h3>
                            <p>학번: <span id="userStudentId"></span></p>
                            <p>이름: <span id="userName"></span></p>
                            <p>ID: <span id="userId"></span></p>
                            <p>비밀번호: <span id="userPassword"></span></p>
                        </div>
            
                        <div id="editUserInfo" class="myPage-section">
                            <h3>회원 정보 수정</h3>
                            <form id="editUserForm">
                                <label for="editStudentId">학번:</label>
                                <input type="number" id="editStudentId" name="studentId" class="myPage-form-control" />
                                <label for="editName">이름:</label>
                                <input type="text" id="editName" name="name" class="myPage-form-control" />
                                <label for="editUsername">ID:</label>
                                <input type="text" id="editUsername" name="username" class="myPage-form-control" />
                                <label for="editPassword">비밀번호:</label>
                                <input type="password" id="editPassword" name="password" class="myPage-form-control" />
                                <button type="submit" class="myPage-btn-custom">수정</button>
                            </form>
                        </div>
            
                        <div id="userRecipes" class="myPage-section">
                            <h3>등록한 레시피</h3>
                            <ul id="userRecipeList"></ul>
                        </div>
            
                        <div id="likedRecipes" class="myPage-section">
                            <h3>좋아요한 레시피</h3>
                            <ul id="likedRecipeList"></ul>
                        </div>
            
                        <div id="userComments" class="myPage-section">
                            <h3>내가 단 댓글</h3>
                            <ul id="userCommentList"></ul>
                        </div>
            
                        <div class="myPage-modal-footer">
                            <button id="logoutBtn" class="myPage-btn-custom">로그아웃</button>
                        </div>
                    </div>
                </div>
            </div>
                        <!-- 로그인 경고 모달 -->
            <div id="loginWarningModal" class="modal" style="display: none;">
                <div class="modal-content">
                    <span class="login-warning-close">&times;</span>
                    <p>로그인이 필요합니다.</p>
                </div>
            </div>

            
        </header>
        <!-- end header section -->

        <!-- slider section -->
        <section class="slider_section">
            <div class="new-area">
                <div class="left-area">
                    <div class="left-text">전체 목록</div>
                    <button id="addButton" class="add-button">추가</button>
                </div>
            </div>

            <div id="customCarousel1" class="carousel slide" data-ride="carousel">
                <div class="tm-list">
                    <!-- 여기서부터 동적으로 메뉴 항목을 추가할 예정 -->
                </div>

                <!-- 레시피 상세 정보 모달 -->
                <div class="recipe-details-modal">
                    <div class="recipe-details-content">
                        <span class="recipe-details-close">&times;</span>
                        <div class="recipe-details-header">
                            <h2 class="recipe-name">음식이름</h2>
                            <div class="recipe-details-filters">
                                <span class="filter">시간</span>
                                <span class="filter">요리 종류</span>
                                <!-- 좋아요 버튼과 개수 추가 -->
                                <div class="tm-list-item-actions-details">
                                    <button class="like-btn">
                                        <i class="fa fa-heart"></i>
                                    </button>
                                    <span class="like-count">0</span>
                                </div>
                            </div>
                        </div>
                        <img class="recipe-details-image" src="" alt="Recipe Image" />
                        <div class="recipe-ingredients">
                            <h3>재료</h3>
                            <p>여기에 재료 설명이 표시됩니다.</p>
                        </div>
                        <div class="recipe-instructions">
                            <h3>레시피</h3>
                            <p>여기에 레시피 설명이 표시됩니다.</p>
                        </div>
                        <div class="recipe-comments">
                            <h3>댓글</h3>
                            <div class="comment-list">
                                <div class="comment-item">
                                    <p><strong>사용자1:</strong> 여기에 첫 번째 댓글이 표시됩니다.</p>
                                </div>
                                <div class="comment-item">
                                    <p><strong>사용자2:</strong> 여기에 두 번째 댓글이 표시됩니다.</p>
                                </div>
                            </div>
                            <textarea placeholder="댓글을 입력하세요"></textarea>
                            <button class="comment-submit-btn">댓글 달기</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!-- end slider section -->
    </div>

    <!-- contact section -->
    <div class="hero_area">
        <div class="hero_bg_box">
            <img src="images/hero-bg.jpg" alt="" />
        </div>

        <div class="contact_section">
            <nav class="navbar navbar-expand-lg custom_nav-container_contact">
                <a class="navbar-brand" href="index.html"> Ourecipe </a>
            </nav>

            <div class="container-fluid">
                <div class="row">
                    <div class="form_container">
                        <div class="heading_container heading_center">
                            <h2>레시피 추가</h2>
                        </div>

                        <form action="/upload-data" method="post" enctype="multipart/form-data">
                            <div class="form-row">
                                <div class="form-group col">
                                    <label for="foodNameInput" style="color: white">음식 이름</label>
                                    <input type="text" class="form-control" id="foodNameInput" name="foodNameInput" placeholder="추가할 음식이름을 작성해주세요." />
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group col-lg-6">
                                    <label for="cookingTime" style="color: white">조리 시간</label>
                                    <select id="cookingTime" name="cookingTime" class="form-control">
                                        <option value="">시간 선택</option>
                                        <option value="5분">5분</option>
                                        <option value="10분">10분</option>
                                        <option value="15분">15분</option>
                                        <option value="20분">20분</option>
                                        <option value="30분">30분</option>
                                        <option value="1시간">1시간 이상</option>
                                    </select>
                                </div>
                                <div class="form-group col-lg-6">
                                    <label for="foodCategory" style="color: white">음식 종류</label>
                                    <select id="foodCategory" name="foodCategory" class="form-control">
                                        <option value="">카테고리 선택</option>
                                        <option value="한식">한식</option>
                                        <option value="중식">중식</option>
                                        <option value="일식">일식</option>
                                        <option value="양식">양식</option>
                                        <option value="기타">기타</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group col">
                                    <label for="material" style="color: white">재료</label>
                                    <input type="text" class="form-control" id="material" name="material" placeholder="재료를 입력해주세요." />
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group col">
                                    <label for="recipe" style="color: white">레시피</label>
                                    <input type="text" class="form-control" id="recipe" name="recipe" placeholder="레시피를 입력해주세요." />
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group col">
                                    <label for="uploadPhoto">음식 사진</label>
                                    <input type="file" class="form-control-file" id="uploadPhoto" name="uploadPhoto" accept="image/*" />
                                </div>
                            </div>

                            <div class="btn_box">
                                <button type="submit">SEND</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- end contact section -->

    <!-- jQery -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <!-- popper js -->
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <!-- bootstrap js -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <!-- owl slider -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js"></script>
    <!-- nice select -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-nice-select/1.1.0/js/jquery.nice-select.min.js" integrity="sha256-Zr3vByTlMGQhvMfgkQ5BtWRSKBGa2QlspKYJnkjZTmo=" crossorigin="anonymous"></script>
    <!-- custom js -->
    <script src="js/custom.js"></script>
    <script>
document.addEventListener("DOMContentLoaded", function () {
    window.currentUser = null;

    function showLoginWarningModal() {
        var warningModal = document.getElementById("loginWarningModal");
        warningModal.style.display = "block";
    }

    function checkLogin(event) {
        if (!window.currentUser) {
            event.preventDefault();
            showLoginWarningModal();
        }
    }

    function handleLogin(event) {
        event.preventDefault();
        var username = document.getElementById("username").value;
        var password = document.getElementById("password").value;

        fetch('data/users.json')
            .then(response => response.json())
            .then(users => {
                var user = users.find(user => user.username === username && user.password === password);
                if (user) {
                    alert('로그인 성공!');
                    window.currentUser = user;
                    // URL에 사용자 이름 추가
                    history.pushState(null, '', `/index.html?user=${username}`);

                    var navbarNav = document.querySelector(".navbar-nav");
                    var loginBtn = document.getElementById("loginBtn");

                    if (loginBtn) {
                        var welcomeMessage = document.createElement("li");
                        welcomeMessage.className = "nav-item";
                        welcomeMessage.innerHTML = `<a class="nav-link"> ${username}님, 환영합니다 </a>`;

                        var myPageButton = document.createElement("li");
                        myPageButton.className = "nav-item";
                        myPageButton.innerHTML = `<a class="nav-link" href="#" id="myPageBtn">마이페이지</a>`;

                        loginBtn.parentNode.replaceChild(welcomeMessage, loginBtn);
                        navbarNav.appendChild(myPageButton);

                        myPageButton.addEventListener("click", showMyPage);

                        var loginModal = document.getElementById("loginModal");
                        loginModal.style.display = "none";
                    }

                    // 로그인 후 버튼 이벤트 리스너 설정
                    setButtonEventListeners();
                } else {
                    alert('아이디 또는 비밀번호가 잘못되었습니다.');
                }
            })
            .catch(error => console.error('Error:', error));
    }

    function showMyPage(event) {
        event.preventDefault();
        if (!window.currentUser) return;

        var myPageModal = document.getElementById("myPageModal");
        document.getElementById("myPageUsername").textContent = `${window.currentUser.username}님의 마이페이지`;
        document.getElementById("userStudentId").textContent = window.currentUser.studentId;
        document.getElementById("userName").textContent = window.currentUser.name;
        document.getElementById("userId").textContent = window.currentUser.username;
        document.getElementById("userPassword").textContent = window.currentUser.password;

        updateUserRecipes(window.currentUser);
        updateLikedRecipes(window.currentUser);
        updateUserComments(window.currentUser);

        myPageModal.style.display = "block";
    }

    function updateUserRecipes(user) {
        var userRecipeList = document.getElementById("userRecipeList");
        userRecipeList.innerHTML = "";
        if (user.recipes) {
            user.recipes.forEach(recipe => {
                var li = document.createElement("li");
                li.textContent = recipe;
                userRecipeList.appendChild(li);
            });
        }
    }

    function updateLikedRecipes(user) {
        var likedRecipeList = document.getElementById("likedRecipeList");
        likedRecipeList.innerHTML = "";
        if (user.likedRecipes) {
            user.likedRecipes.forEach(recipe => {
                var li = document.createElement("li");
                li.textContent = recipe;
                likedRecipeList.appendChild(li);
            });
        }
    }

    function updateUserComments(user) {
        var userCommentList = document.getElementById("userCommentList");
        userCommentList.innerHTML = "";
        if (user.comments) {
            user.comments.forEach(comment => {
                var li = document.createElement("li");
                li.textContent = comment;
                userCommentList.appendChild(li);
            });
        }
    }

    function handleLogout() {
        window.currentUser = null;
        alert('로그아웃 되었습니다.');

        var navbarNav = document.querySelector(".navbar-nav");
        var myPageBtn = document.getElementById("myPageBtn").closest('li');
        if (myPageBtn) {
            var loginBtn = document.createElement("li");
            loginBtn.className = "nav-item";
            loginBtn.innerHTML = `<button class="btn nav-link login-button" type="button" id="loginBtn">
                                    <i class="fa fa-user" aria-hidden="true"></i> Login
                                </button>`;
            navbarNav.replaceChild(loginBtn, myPageBtn);

            loginBtn.querySelector('#loginBtn').addEventListener("click", function () {
                var loginModal = document.getElementById("loginModal");
                loginModal.style.display = "block";
            });
        }

        history.pushState(null, '', '/');
        location.reload();
    }

    document.getElementById("loginForm").addEventListener("submit", handleLogin);

    var closeMyPageBtn = document.querySelector(".close-mypage");
    closeMyPageBtn.onclick = function () {
        var myPageModal = document.getElementById("myPageModal");
        myPageModal.style.display = "none";
    };

    window.onclick = function (event) {
        var myPageModal = document.getElementById("myPageModal");
        if (event.target == myPageModal) {
            myPageModal.style.display = "none";
        }
    };

    // 이벤트 리스너 설정 함수
    function setButtonEventListeners() {
        // 상세 정보 버튼 클릭 이벤트 설정
        document.querySelectorAll(".details-btn").forEach(button => {
            button.addEventListener("click", function(event) {
                if (!window.currentUser) {
                    showLoginWarningModal();
                    return;
                }
                event.stopPropagation();
                const details = document.querySelector(".recipe-details-modal");
                const listItem = button.closest(".tm-list-item");
                const itemData = JSON.parse(listItem.getAttribute("data-item"));
                document.querySelector(".recipe-details-image").src = `image/${itemData.image}`;
                document.querySelector(".recipe-name").textContent = itemData.name;
                const filters = document.querySelectorAll(".recipe-details-filters .filter");
                filters[0].textContent = itemData.time;
                filters[1].textContent = itemData.category;
                document.querySelector(".recipe-ingredients p").textContent = itemData.material;
                document.querySelector(".recipe-instructions p").textContent = itemData.recipe;
                details.style.display = "block";
                listItem.classList.add("active");

                // 상세 정보 모달 닫기 버튼 설정
                const closeModalBtn = details.querySelector(".recipe-details-close");
                closeModalBtn.addEventListener("click", function () {
                    details.style.display = "none";
                    listItem.classList.remove("active");
                });
            });
        });

        // 좋아요 버튼 클릭 이벤트 설정
        document.querySelectorAll(".like-btn").forEach(button => {
            button.addEventListener("click", function(event) {
                if (!window.currentUser) {
                    showLoginWarningModal();
                    return;
                }
                const listItem = button.closest(".tm-list-item");
                const likeCount = listItem.querySelector(".like-count");
                likeCount.textContent = parseInt(likeCount.textContent) + 1;
                // 서버에 좋아요 정보 저장 로직 추가
            });
        });

        // 댓글 버튼 클릭 이벤트 설정
        document.querySelectorAll(".comment-btn").forEach(button => {
            button.addEventListener("click", function(event) {
                if (!window.currentUser) {
                    showLoginWarningModal();
                    return;
                }
                event.stopPropagation();
                const listItem = button.closest(".tm-list-item");
                const detailsModal = document.querySelector(".recipe-details-modal");
                const commentsSection = detailsModal.querySelector(".comment-list");

                const commentListModal = document.createElement("div");
                commentListModal.classList.add("comment-list-modal");
                commentListModal.innerHTML = `
                    <div class="comment-list-content">
                        <span class="comment-list-close">&times;</span>
                        ${commentsSection.innerHTML}
                    </div>
                `;
                document.body.appendChild(commentListModal);
                commentListModal.style.display = "block";

                const closeBtn = commentListModal.querySelector(".comment-list-close");
                closeBtn.addEventListener("click", function () {
                    commentListModal.style.display = "none";
                    document.body.removeChild(commentListModal);
                });

                window.addEventListener("click", function (event) {
                    if (event.target === commentListModal) {
                        commentListModal.style.display = "none";
                        document.body.removeChild(commentListModal);
                    }
                });
            });
        });

        // 공유 버튼 클릭 이벤트 설정
        document.querySelectorAll(".share-btn").forEach(button => {
            button.addEventListener("click", function(event) {
                if (!window.currentUser) {
                    showLoginWarningModal();
                    return;
                }
                event.stopPropagation();
                const shareModal = button.nextElementSibling;
                shareModal.style.display = "block";

                const closeShareBtn = shareModal.querySelector(".share-close");
                closeShareBtn.onclick = function () {
                    shareModal.style.display = "none";
                };

                window.onclick = function (event) {
                    if (event.target == shareModal) {
                        shareModal.style.display = "none";
                    }
                };
            });
        });
    }

    setButtonEventListeners();

    var loginWarningCloseBtn = document.querySelector(".login-warning-close");
    loginWarningCloseBtn.onclick = function () {
        var loginWarningModal = document.getElementById("loginWarningModal");
        loginWarningModal.style.display = "none";
    };

    var addButton = document.getElementById("addButton");
    addButton.addEventListener("click", function (event) {
        if (window.currentUser) {
            document.querySelector(".contact_section").scrollIntoView({ behavior: 'smooth' });
        } else {
            checkLogin(event); // 로그인 여부 확인
        }
    });

    var ourecipeButton = document.querySelector(".navbar-brand");
    ourecipeButton.addEventListener("click", function (event) {
        event.preventDefault();
        const params = new URLSearchParams(window.location.search);
        const username = params.get('user');
        if (username) {
            window.location.href = `/index.html?user=${username}`;
        } else {
            window.location.href = "/index.html";
        }
    });

    function checkLoginStatus() {
        const params = new URLSearchParams(window.location.search);
        const username = params.get('user');

        if (username) {
            fetch('data/users.json')
                .then(response => response.json())
                .then(users => {
                    var user = users.find(user => user.username === username);
                    if (user) {
                        window.currentUser = user;

                        var navbarNav = document.querySelector(".navbar-nav");
                        var loginBtn = document.getElementById("loginBtn");

                        if (loginBtn) {
                            var welcomeMessage = document.createElement("li");
                            welcomeMessage.className = "nav-item";
                            welcomeMessage.innerHTML = `<a class="nav-link"> ${username}님, 환영합니다 </a>`;

                            var myPageButton = document.createElement("li");
                            myPageButton.className = "nav-item";
                            myPageButton.innerHTML = `<a class="nav-link" href="#" id="myPageBtn">마이페이지</a>`;

                            loginBtn.parentNode.replaceChild(welcomeMessage, loginBtn);
                            navbarNav.appendChild(myPageButton);

                            myPageButton.addEventListener("click", showMyPage);
                        }

                        setButtonEventListeners();
                    }
                })
                .catch(error => console.error('Error:', error));
        }
    }

    checkLoginStatus();
});


        </script>
        
            
<script>
document.addEventListener("DOMContentLoaded", function () {
    function handleLogin(event) {
        event.preventDefault();
        var username = document.getElementById("username").value;
        var password = document.getElementById("password").value;

        fetch('data/users.json')
            .then(response => response.json())
            .then(users => {
                var user = users.find(user => user.username === username && user.password === password);
                if (user) {
                    alert('로그인 성공!');
                    window.currentUser = user;
                    // URL에 사용자 이름 추가
                    history.pushState(null, '', `/index.html?user=${username}`);

                    var navbarNav = document.querySelector(".navbar-nav");
                    var loginBtn = document.getElementById("loginBtn");

                    if (loginBtn) {
                        var welcomeMessage = document.createElement("li");
                        welcomeMessage.className = "nav-item";
                        welcomeMessage.innerHTML = `<a class="nav-link"> ${username}님, 환영합니다 </a>`;

                        var myPageButton = document.createElement("li");
                        myPageButton.className = "nav-item";
                        myPageButton.innerHTML = `<a class="nav-link" href="#" id="myPageBtn">마이페이지</a>`;

                        loginBtn.parentNode.replaceChild(welcomeMessage, loginBtn);
                        navbarNav.appendChild(myPageButton);

                        myPageButton.addEventListener("click", showMyPage);

                        var loginModal = document.getElementById("loginModal");
                        loginModal.style.display = "none";
                    }
                } else {
                    alert('아이디 또는 비밀번호가 잘못되었습니다.');
                }
            })
            .catch(error => console.error('Error:', error));
    }

    document.getElementById("loginForm").addEventListener("submit", handleLogin);

    var registerLink = document.getElementById("registerLink");
    var registerModal = document.getElementById("registerModal");
    var closeRegisterBtn = document.querySelector(".close-register");

    var loginBtn = document.getElementById("loginBtn");
    loginBtn.onclick = function () {
        var loginModal = document.getElementById("loginModal");
        loginModal.style.display = "block";
    };

    var closeLoginBtn = document.querySelector(".close");
    closeLoginBtn.onclick = function () {
        var loginModal = document.getElementById("loginModal");
        loginModal.style.display = "none";
    };

    registerLink.onclick = function (event) {
        event.preventDefault();
        var loginModal = document.getElementById("loginModal");
        loginModal.style.display = "none";
        registerModal.style.display = "block";
    };

    closeRegisterBtn.onclick = function () {
        registerModal.style.display = "none";
    };

    var registerForm = document.getElementById("registerForm");
    var warningModal = document.getElementById("warningModal");
    var warningText = document.getElementById("warning-text");
    var closeWarningBtn = document.querySelector(".warning-close");
    var successModal = document.getElementById("successModal");
    var closeSuccessBtn = document.querySelector(".success-close");

    registerForm.onsubmit = function (event) {
        event.preventDefault();
        var newUsername = document.getElementById("new-username").value;
        var formData = new FormData(registerForm);

        fetch('/check-username?username=' + newUsername)
            .then(response => response.json())
            .then(data => {
                if (data.exists) {
                    warningText.textContent = "이미 존재하는 ID입니다.";
                    warningModal.style.display = "block";
                } else {
                    // 기존의 성공 모달을 숨기고 새로 회원가입 요청을 보냅니다.
                    fetch('/register', {
                        method: 'POST',
                        body: formData
                    })
                    .then(response => response.json())
                    .then(result => {
                        if (result.message === "회원가입이 완료되었습니다.") {
                            warningModal.style.display = "none";
                            successModal.style.display = "block";

                            setTimeout(function () {
                                successModal.style.display = "none";
                                registerModal.style.display = "none";
                                var loginModal = document.getElementById("loginModal");
                                loginModal.style.display = "block";
                            }, 2000);
                        } else {
                            warningText.textContent = result.message || "회원가입에 실패했습니다.";
                            warningModal.style.display = "block";
                        }
                    })
                    .catch(error => console.error('Error:', error));
                }
            })
            .catch(error => console.error('Error:', error));
    };

    closeWarningBtn.onclick = function () {
        warningModal.style.display = "none";
    };

    closeSuccessBtn.onclick = function () {
        successModal.style.display = "none";
    };

    window.onclick = function (event) {
        var loginModal = document.getElementById("loginModal");
        var registerModal = document.getElementById("registerModal");
        var successModal = document.getElementById("successModal");
        var warningModal = document.getElementById("warningModal");
        var myPageModal = document.getElementById("myPageModal");
        if (event.target == loginModal) {
            loginModal.style.display = "none";
        }
        if (event.target == registerModal) {
            registerModal.style.display = "none";
        }
        if (event.target == successModal) {
            successModal.style.display = "none";
        }
        if (event.target == warningModal) {
            warningModal.style.display = "none";
        }
        if (event.target == myPageModal) {
            myPageModal.style.display = "none";
        }
    };
});
</script>

<script>
    // 음식 필터링
    document.addEventListener("DOMContentLoaded", function () {
        function filterMenuItems(menuItems) {
            const foodValue = document.getElementById("foodInput").value.trim().toLowerCase();
            const timeValue = document.getElementById("timeSelect").value;
            const categoryValue = document.getElementById("categorySelect").value;
    
            return menuItems.filter(item => {
                const matchesFood = !foodValue || item.name.toLowerCase().includes(foodValue);
                const matchesTime = !timeValue || item.time === timeValue;
                const matchesCategory = !categoryValue || item.category === categoryValue;
                return matchesFood && matchesTime && matchesCategory;
            });
        }
    
        function displayMenuItems(filteredItems) {
            const menuContainer = document.querySelector("#customCarousel1 .tm-list");
            menuContainer.innerHTML = ""; // 기존 내용 초기화
            filteredItems.forEach((item) => {
                const menuItemHtml = `
                    <div class="tm-list-item" data-item='${JSON.stringify(item)}'>          
                        <img src="image/${item.image}" alt="${item.name}" class="tm-list-item-img">
                        <div class="tm-list-item-content">
                            <div class="tm-list-item-header">
                                <h3 class="tm-list-item-name">${item.name}</h3>
                                <div class="tm-list-item-filters">
                                    <span class="filter">${item.time}</span>
                                    <span class="filter">${item.category}</span>
                                </div>
                                <div class="tm-list-item-id-date">
                                    <span class="tm-list-item-id">ID: ${item.userId}/</span>
                                    <span class="tm-list-item-date">업데이트 날짜</span>
                                </div>
                            </div>
                            <div class="tm-list-item-footer">
                                <button class="details-btn">상세 정보</button>
                                <div class="tm-list-item-actions">
                                    <button class="like-btn" ${!window.currentUser ? 'disabled' : ''}>
                                        <i class="fa fa-heart"></i>
                                    </button>
                                    <span class="like-count">0</span>
                                    <button class="comment-btn" ${!window.currentUser ? 'disabled' : ''}>
                                        <i class="fa fa-comment"></i>
                                    </button>
                                    <span class="comment-count">0</span>
                                    <div class="comment-list-modal">
                                        <div class="comment-list-content">
                                            <span class="comment-list-close">&times;</span>
                                            <div class="comment-list">
                                                <h3>댓글</h3>
                                                <p>댓글이 없습니다.</p>
                                            </div>
                                            <textarea placeholder="댓글을 입력하세요"></textarea>
                                            <button class="comment-submit-btn" ${!window.currentUser ? 'disabled' : ''}>댓글 달기</button>
                                        </div>
                                    </div>
                                    <button class="share-btn" ${!window.currentUser ? 'disabled' : ''}>
                                        <i class="fa fa-share"></i>
                                    </button>
                                    <div id="shareModal" class="modal">
                                        <div class="modal-content">
                                            <span class="share-close">&times;</span>
                                            <h2>공유하기</h2>
                                            <form class="shareForm">
                                                <label for="recipient-email">이메일 주소:</label>
                                                <input type="email" id="recipient-email" name="recipient-email" placeholder="이메일 주소 입력">
                                                <button type="submit" class="share-submit-btn">보내기</button>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>`;
                menuContainer.innerHTML += menuItemHtml;
            });
    
            attachEventListeners();
        }
    
        function loadFilteredMenuItems() {
            fetch("/menu-items")
                .then((response) => response.json())
                .then((menuItems) => {
                    const filteredItems = filterMenuItems(menuItems);
                    displayMenuItems(filteredItems);
                })
                .catch((error) => console.error("Error loading the menu items:", error));
        }
    
        // 검색 버튼 클릭 시 필터링된 결과 표시
        const searchButton = document.querySelector(".nav_search-btn");
        searchButton.addEventListener("click", function (event) {
            event.preventDefault(); // 기본 제출 행위 방지
            loadFilteredMenuItems(); // 메뉴 항목 로드 및 필터링된 결과 표시
        });
    });
    </script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        function loadMenuItems() {
            const menuContainer = document.querySelector("#customCarousel1 .tm-list");
    
            fetch("/menu-items")
                .then((response) => response.json())
                .then((menuItems) => {
                    menuContainer.innerHTML = "";
                    menuItems.forEach((item) => {
                        const menuItemHtml = `
                            <div class="tm-list-item" data-item='${JSON.stringify(item)}'>          
                                <img src="image/${item.image}" alt="${item.name}" class="tm-list-item-img">
                                <div class="tm-list-item-content">
                                    <div class="tm-list-item-header">
                                        <h3 class="tm-list-item-name">${item.name}</h3>
                                        <div class="tm-list-item-filters">
                                            <span class="filter">${item.time}</span>
                                            <span class="filter">${item.category}</span>
                                        </div>
                                        <div class="tm-list-item-id-date">
                                            <span class="tm-list-item-id">${item.userId}/</span>
                                            <span class="tm-list-item-date">업데이트 날짜</span>
                                        </div>
                                    </div>
                                    <div class="tm-list-item-footer">
                                        <button class="details-btn">상세 정보</button>
                                        <div class="tm-list-item-actions">
                                            <button class="like-btn">
                                                <i class="fa fa-heart"></i>
                                            </button>
                                            <span class="like-count">0</span>
                                            <button class="comment-btn">
                                                <i class="fa fa-comment"></i>
                                            </button>
                                            <span class="comment-count">0</span>
                                            <div class="comment-list-modal">
                                                <div class="comment-list-content">
                                                    <span class="comment-list-close">&times;</span>
                                                    <div class="comment-list">
                                                        <h3>댓글</h3>
                                                        <p>댓글이 없습니다.</p>
                                                    </div>
                                                    <textarea placeholder="댓글을 입력하세요"></textarea>
                                                    <button class="comment-submit-btn">댓글 달기</button>
                                                </div>
                                            </div>
                                            <button class="share-btn">
                                                <i class="fa fa-share"></i>
                                            </button>
                                            <div id="shareModal" class="modal">
                                                <div class="modal-content">
                                                    <span class="share-close">&times;</span>
                                                    <h2>공유하기</h2>
                                                    <form class="shareForm">
                                                        <label for="recipient-email">이메일 주소:</label>
                                                        <input type="email" id="recipient-email" name="recipient-email" placeholder="이메일 주소 입력">
                                                        <button type="submit" class="share-submit-btn">보내기</button>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>`;
                        menuContainer.innerHTML += menuItemHtml;
                    });
    
                    attachEventListeners();
                    setButtonEventListeners();
                })
                .catch((error) => console.error("Error loading the menu items:", error));
        }
    
        loadMenuItems();
    });
    </script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        function showMyPage(event) {
            event.preventDefault();
            if (!window.currentUser) return;
    
            var myPageModal = document.getElementById("myPageModal");
            document.getElementById("myPageUsername").textContent = `${window.currentUser.username}님의 마이페이지`;
            document.getElementById("userStudentId").textContent = window.currentUser.studentId;
            document.getElementById("userName").textContent = window.currentUser.name;
            document.getElementById("userId").textContent = window.currentUser.username;
            document.getElementById("userPassword").textContent = window.currentUser.password;
    
            updateUserRecipes(window.currentUser);
            updateLikedRecipes(window.currentUser);
            updateUserComments(window.currentUser);
    
            myPageModal.style.display = "block";
        }
    
        function updateUserRecipes(user) {
            var userRecipeList = document.getElementById("userRecipeList");
            userRecipeList.innerHTML = "";
            if (user.recipes) {
                user.recipes.forEach(recipe => {
                    var li = document.createElement("li");
                    li.textContent = recipe;
                    userRecipeList.appendChild(li);
                });
            }
        }
    
        function updateLikedRecipes(user) {
            var likedRecipeList = document.getElementById("likedRecipeList");
            likedRecipeList.innerHTML = "";
            if (user.likedRecipes) {
                user.likedRecipes.forEach(recipe => {
                    var li = document.createElement("li");
                    li.textContent = recipe;
                    likedRecipeList.appendChild(li);
                });
            }
        }
    
        function updateUserComments(user) {
            var userCommentList = document.getElementById("userCommentList");
            userCommentList.innerHTML = "";
            if (user.comments) {
                user.comments.forEach(comment => {
                    var li = document.createElement("li");
                    li.textContent = comment;
                    userCommentList.appendChild(li);
                });
            }
        }
    
        function handleLogout() {
            window.currentUser = null;
            alert('로그아웃 되었습니다.');
    
            var navbarNav = document.querySelector(".navbar-nav");
            var myPageBtn = document.getElementById("myPageBtn").closest('li');
            if (myPageBtn) {
                var loginBtn = document.createElement("li");
                loginBtn.className = "nav-item";
                loginBtn.innerHTML = `<button class="btn nav-link login-button" type="button" id="loginBtn">
                                        <i class="fa fa-user" aria-hidden="true"></i> Login
                                    </button>`;
                navbarNav.replaceChild(loginBtn, myPageBtn);
    
                loginBtn.querySelector('#loginBtn').addEventListener("click", function () {
                    var loginModal = document.getElementById("loginModal");
                    loginModal.style.display = "block";
                });
            }
    
            history.pushState(null, '', '/');
            location.reload();
        }
    
        document.getElementById("logoutBtn").addEventListener("click", handleLogout);
    
        var closeMyPageBtn = document.querySelector(".close-mypage");
        closeMyPageBtn.onclick = function () {
            var myPageModal = document.getElementById("myPageModal");
            myPageModal.style.display = "none";
        };
    
        window.onclick = function (event) {
            var myPageModal = document.getElementById("myPageModal");
            if (event.target == myPageModal) {
                myPageModal.style.display = "none";
            }
        };
    
        window.showMyPage = showMyPage;
    });

    </script>
             
</body>
</html>
