<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ourecipe</title>
    <link rel="shortcut icon" href="images/fevicon.png" type="image/x-icon" />
    <link rel="stylesheet" type="text/css" href="css/bootstrap.css" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-nice-select/1.1.0/css/nice-select.min.css" />
    <link href="css/font-awesome.min.css" rel="stylesheet" />
    <link href="css/style.css" rel="stylesheet" />
    <link href="css/responsive.css" rel="stylesheet" />
</head>

<body>
    <!-- 배경 -->
    <div class="hero_area">
        <div class="hero_bg_box">
            <img src="images/hero-bg.jpg" alt="" />
        </div>

        <!-- header section starts -->
        <header class="header_section">
            <nav class="navbar navbar-expand-lg custom_nav-container">
                <a class="navbar-brand" href="index.html"> Ourecipe </a>

                <!-- 검색 및 로그인 영역 -->
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                    <span class=""> </span>
                </button>
                <ul class="navbar-nav">
                    <div class="navbar-collapse" id="navbarSupportedContent">
                        <form class="form-inline justify-content-center" style="flex-grow: 1">
                            <button class="btn my-2 my-sm-0 nav_search-btn" type="submit">
                                <i class="fa fa-search" aria-hidden="true"></i>
                            </button>

                            <div class="form-row">
                                <div class="form-group col-lg-6">
                                    <input type="text" class="form-control" id="foodInput" placeholder="음식을 입력해 주세요." />
                                </div>

                                <div class="form-group col-lg-6">
                                    <select name="" id="timeSelect" class="form-control wide">
                                        <option value="">조리시간 선택</option>
                                        <option value="5분">5분</option>
                                        <option value="10분">10분</option>
                                        <option value="15분">15분</option>
                                        <option value="20분">20분</option>
                                        <option value="30분">30분</option>
                                        <option value="1시간">1시간</option>
                                    </select>
                                    <select name="" id="categorySelect" class="form-control wide">
                                        <option value="">카테고리 선택</option>
                                        <option value="한식">한식</option>
                                        <option value="중식">중식</option>
                                        <option value="일식">일식</option>
                                        <option value="양식">양식</option>
                                    </select>
                                </div>
                            </div>
                        </form>
                    </div>

                    <!-- Login Modal -->
                    <!-- 로그인 버튼 -->
                    <button class="btn nav-link login-button" type="button" id="loginBtn">
                        <i class="fa fa-user" aria-hidden="true"></i> Login
                    </button>

                    <!-- 로그인 모달 -->
                    <div id="loginModal" class="modal">
                        <div class="modal-content">
                            <span class="close">&times;</span>
                            <form id="loginForm">
                                <label for="username">ID:</label>
                                <input type="text" id="username" name="username" placeholder="아이디 입력" />
                                <label for="password">PW:</label>
                                <input type="password" id="password" name="password" placeholder="비밀번호 입력" />
                                <button type="submit" class="login-submit-btn">Login</button>
                            </form>
                            <div class="register-link">
                                <a href="#" id="registerLink">회원가입</a>
                            </div>
                        </div>
                    </div>

                    <!-- 회원가입 모달 -->
                    <div id="registerModal" class="modal">
                        <div class="modal-content">
                            <span class="close-register">&times;</span>
                            <form id="registerForm" action="/register" method="post">
                                <label for="student-id">학번:</label>
                                <input type="number" id="student-id" name="studentId" placeholder="학번 입력" />
                                <label for="name">이름:</label>
                                <input type="text" id="name" name="name" placeholder="이름 입력" />
                                <label for="new-username">등록할 ID:</label>
                                <input type="text" id="new-username" name="username" placeholder="ID 입력" />
                                <label for="new-password">등록할 비밀번호:</label>
                                <input type="password" id="new-password" name="password" placeholder="비밀번호 입력" />
                                <button type="submit" class="register-submit-btn">Register</button>
                                <div id="error-message"></div>
                            </form>
                        </div>
                    </div>
                    <!-- 경고 모달 -->
                    <div id="warningModal" class="modal" style="display: none;">
                        <div class="modal-content">
                        <span class="warning-close">&times;</span>
                        <p id="warning-text"></p>
                        </div>
                    </div>
                    
                    <!-- 회원가입 완료 모달 -->
                    <div id="successModal" class="modal" style="display: none;">
                        <div class="modal-content">
                        <span class="success-close">&times;</span>
                        <p>회원가입이 완료되었습니다!</p>
                        </div>
                    </div>
                </ul>
            </nav>
            <!-- 마이페이지 모달 -->
            <<div id="myPageModal" class="modal">
                <div class="myPage-modal-content">
                    <div class="myPage-modal-header">
                        <span class="close-mypage">&times;</span>
                        <h2 id="myPageUsername">마이페이지</h2>
                    </div>
                    <div class="myPage-modal-body">
                        <div id="userInfo" class="myPage-section">
                            <h3>회원 정보</h3>
                            <p>학번: <span id="userStudentId"></span></p>
                            <p>이름: <span id="userName"></span></p>
                            <p>ID: <span id="userId"></span></p>
                            <p>비밀번호: <span id="userPassword"></span></p>
                        </div>
            
                        <div id="editUserInfo" class="myPage-section">
                            <h3>회원 정보 수정</h3>
                            <form id="editUserForm">
                                <label for="editStudentId">학번:</label>
                                <input type="number" id="editStudentId" name="studentId" class="myPage-form-control" />
                                <label for="editName">이름:</label>
                                <input type="text" id="editName" name="name" class="myPage-form-control" />
                                <label for="editUsername">ID:</label>
                                <input type="text" id="editUsername" name="username" class="myPage-form-control" />
                                <label for="editPassword">비밀번호:</label>
                                <input type="password" id="editPassword" name="password" class="myPage-form-control" />
                                <button type="submit" class="myPage-btn-custom">수정</button>
                            </form>
                        </div>
            
                        <div id="userRecipes" class="myPage-section">
                            <h3>등록한 레시피</h3>
                            <ul id="userRecipeList"></ul>
                        </div>
            
                        <div id="likedRecipes" class="myPage-section">
                            <h3>좋아요한 레시피</h3>
                            <ul id="likedRecipeList"></ul>
                        </div>
            
                        <div id="userComments" class="myPage-section">
                            <h3>내가 단 댓글</h3>
                            <ul id="userCommentList"></ul>
                        </div>
            
                        <div class="myPage-modal-footer">
                            <button id="logoutBtn" class="myPage-btn-custom">로그아웃</button>
                        </div>
                    </div>
                </div>
            </div>
            
        </header>
        <!-- end header section -->

        <!-- slider section -->
        <section class="slider_section">
            <div class="new-area">
                <div class="left-area">
                    <div class="left-text">전체 목록</div>
                    <button id="addButton" class="add-button">추가</button>
                </div>
            </div>

            <div id="customCarousel1" class="carousel slide" data-ride="carousel">
                <div class="tm-list">
                    <!-- 여기서부터 동적으로 메뉴 항목을 추가할 예정 -->
                </div>

                <!-- 레시피 상세 정보 모달 -->
                <div class="recipe-details-modal">
                    <div class="recipe-details-content">
                        <span class="recipe-details-close">&times;</span>
                        <div class="recipe-details-header">
                            <h2 class="recipe-name">음식이름</h2>
                            <div class="recipe-details-filters">
                                <span class="filter">시간</span>
                                <span class="filter">요리 종류</span>
                                <!-- 좋아요 버튼과 개수 추가 -->
                                <div class="tm-list-item-actions-details">
                                    <button class="like-btn">
                                        <i class="fa fa-heart"></i>
                                    </button>
                                    <span class="like-count">0</span>
                                </div>
                            </div>
                        </div>
                        <img class="recipe-details-image" src="" alt="Recipe Image" />
                        <div class="recipe-ingredients">
                            <h3>재료</h3>
                            <p>여기에 재료 설명이 표시됩니다.</p>
                        </div>
                        <div class="recipe-instructions">
                            <h3>레시피</h3>
                            <p>여기에 레시피 설명이 표시됩니다.</p>
                        </div>
                        <div class="recipe-comments">
                            <h3>댓글</h3>
                            <div class="comment-list">
                                <div class="comment-item">
                                    <p><strong>사용자1:</strong> 여기에 첫 번째 댓글이 표시됩니다.</p>
                                </div>
                                <div class="comment-item">
                                    <p><strong>사용자2:</strong> 여기에 두 번째 댓글이 표시됩니다.</p>
                                </div>
                            </div>
                            <textarea placeholder="댓글을 입력하세요"></textarea>
                            <button class="comment-submit-btn">댓글 달기</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!-- end slider section -->
    </div>

    <!-- contact section -->
    <div class="hero_area">
        <div class="hero_bg_box">
            <img src="images/hero-bg.jpg" alt="" />
        </div>

        <div class="contact_section">
            <nav class="navbar navbar-expand-lg custom_nav-container_contact">
                <a class="navbar-brand" href="index.html"> Ourecipe </a>
            </nav>

            <div class="container-fluid">
                <div class="row">
                    <div class="form_container">
                        <div class="heading_container heading_center">
                            <h2>레시피 추가</h2>
                        </div>

                        <form action="/upload-data" method="post" enctype="multipart/form-data">
                            <div class="form-row">
                                <div class="form-group col">
                                    <label for="foodNameInput" style="color: white">음식 이름</label>
                                    <input type="text" class="form-control" id="foodNameInput" name="foodNameInput" placeholder="추가할 음식이름을 작성해주세요." />
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group col-lg-6">
                                    <label for="cookingTime" style="color: white">조리 시간</label>
                                    <select id="cookingTime" name="cookingTime" class="form-control">
                                        <option value="">시간 선택</option>
                                        <option value="5분">5분</option>
                                        <option value="10분">10분</option>
                                        <option value="15분">15분</option>
                                        <option value="20분">20분</option>
                                        <option value="30분">30분</option>
                                        <option value="1시간">1시간 이상</option>
                                    </select>
                                </div>
                                <div class="form-group col-lg-6">
                                    <label for="foodCategory" style="color: white">음식 종류</label>
                                    <select id="foodCategory" name="foodCategory" class="form-control">
                                        <option value="">카테고리 선택</option>
                                        <option value="한식">한식</option>
                                        <option value="중식">중식</option>
                                        <option value="일식">일식</option>
                                        <option value="양식">양식</option>
                                        <option value="기타">기타</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group col">
                                    <label for="material" style="color: white">재료</label>
                                    <input type="text" class="form-control" id="material" name="material" placeholder="재료를 입력해주세요." />
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group col">
                                    <label for="recipe" style="color: white">레시피</label>
                                    <input type="text" class="form-control" id="recipe" name="recipe" placeholder="레시피를 입력해주세요." />
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group col">
                                    <label for="uploadPhoto">음식 사진</label>
                                    <input type="file" class="form-control-file" id="uploadPhoto" name="uploadPhoto" accept="image/*" />
                                </div>
                            </div>

                            <div class="btn_box">
                                <button type="submit">SEND</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- end contact section -->

    <!-- jQery -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <!-- popper js -->
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <!-- bootstrap js -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <!-- owl slider -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js"></script>
    <!-- nice select -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-nice-select/1.1.0/js/jquery.nice-select.min.js" integrity="sha256-Zr3vByTlMGQhvMfgkQ5BtWRSKBGa2QlspKYJnkjZTmo=" crossorigin="anonymous"></script>
    <!-- custom js -->
    <script src="js/custom.js"></script>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const foodInput = document.getElementById("foodInput");
            const timeSelect = document.getElementById("timeSelect");
            const categorySelect = document.getElementById("categorySelect");
            const leftText = document.querySelector(".left-text");
            const searchButton = document.querySelector(".nav_search-btn"); // 돋보기 버튼
            const addButton = document.querySelector(".add-button");

            function updateLeftText() {
                // 초기에 '전체 목록' 텍스트를 클리어
                leftText.innerHTML = "";

                // 음식 이름이 입력되어 있으면 표시
                const foodValue = foodInput.value.trim();
                if (foodValue) {
                    leftText.textContent = `${foodValue}  `;
                }

                // 시간이 선택되어 있으면 span 요소로 추가
                const timeValue = timeSelect.value;
                if (timeValue) {
                    const timeBadge = document.createElement("span");
                    timeBadge.className = "filter-badge";
                    timeBadge.textContent = `시간: ${timeValue}`;
                    leftText.appendChild(timeBadge); // left-text 영역에 추가
                }

                // 카테고리가 선택되어 있으면 span 요소로 추가
                const categoryValue = categorySelect.value;
                if (categoryValue) {
                    const categoryBadge = document.createElement("span");
                    categoryBadge.className = "filter-badge";
                    categoryBadge.textContent = `카테고리: ${categoryValue}`;
                    leftText.appendChild(categoryBadge); // left-text 영역에 추가
                }
            }

            searchButton.addEventListener("click", function (event) {
                event.preventDefault(); // 기본 제출 행위 방지
                updateLeftText(); // left-text 업데이트
            });
        });

        document.addEventListener("DOMContentLoaded", function () {
            const addButton = document.getElementById("addButton");
            addButton.addEventListener("click", function () {
                const contactSection = document.querySelector(".contact_section");
                contactSection.scrollIntoView({ behavior: "smooth" });
            });
        });
    </script>

    <script>
        // 문서가 로드되면 함수를 실행
        document.addEventListener("DOMContentLoaded", function () {
            const menuContainer = document.querySelector("#customCarousel1 .tm-list");

            // 서버에서 메뉴 아이템을 가져오는 HTTP 요청을 보냄
            fetch("/menu-items")
                .then((response) => response.json()) // 응답을 JSON 형식으로 파싱
                .then((menuItems) => {
                    menuContainer.innerHTML = ""; // 기존 내용 초기화
                    menuItems.forEach((item) => {
                        const menuItemHtml = `
                            <div class="tm-list-item" data-item='${JSON.stringify(item)}'>          
                                <img src="image/${item.image}" alt="${item.name}" class="tm-list-item-img">
                                <div class="tm-list-item-content">
                                    <div class="tm-list-item-header">
                                        <h3 class="tm-list-item-name">${item.name}</h3>
                                        <div class="tm-list-item-filters">
                                            <span class="filter">${item.time}</span>
                                            <span class="filter">${item.category}</span>
                                        </div>
                                        <div class="tm-list-item-id-date">
                                            <span class="tm-list-item-id">ID: 사용자아이디/</span>
                                            <span class="tm-list-item-date">업데이트 날짜</span>
                                        </div>
                                    </div>
                                    <div class="tm-list-item-footer">
                                        <button class="details-btn">상세 정보</button>
                                        <div class="tm-list-item-actions">
                                            <button class="like-btn">
                                                <i class="fa fa-heart"></i>
                                            </button>
                                            <span class="like-count">0</span>
                                            <button class="comment-btn">
                                                <i class="fa fa-comment"></i>
                                            </button>
                                            <span class="comment-count">0</span>
                                            <!-- 댓글 목록 모달 -->
                                            <div class="comment-list-modal">
                                                <div class="comment-list-content">
                                                    <span class="comment-list-close">&times;</span>
                                                    <div class="comment-list">
                                                        <h3>댓글</h3>
                                                        <p>댓글이 없습니다.</p>
                                                    </div>
                                                    <textarea placeholder="댓글을 입력하세요"></textarea>
                                                    <button class="comment-submit-btn">댓글 달기</button>
                                                </div>
                                            </div>
                                            <!-- 공유 버튼 -->
                                            <button class="share-btn">
                                                <i class="fa fa-share"></i>
                                            </button>
                                            <!-- 이메일 공유 모달 -->
                                            <div id="shareModal" class="modal">
                                                <div class="modal-content">
                                                    <span class="share-close">&times;</span>
                                                    <h2>공유하기</h2>
                                                    <form class="shareForm">
                                                        <label for="recipient-email">이메일 주소:</label>
                                                        <input type="email" id="recipient-email" name="recipient-email" placeholder="이메일 주소 입력">
                                                        <button type="submit" class="share-submit-btn">보내기</button>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>`;
                        menuContainer.innerHTML += menuItemHtml; // 컨테이너에 HTML 추가
                    });

                    // 이벤트 리스너를 추가
                    attachEventListeners();
                })
                .catch((error) => console.error("Error loading the menu items:", error));
        });

        function attachEventListeners() {
            // 상세 정보 버튼 이벤트 리스너
            const detailsBtns = document.querySelectorAll(".details-btn");
            detailsBtns.forEach((btn) => {
                btn.addEventListener("click", function (event) {
                    event.stopPropagation();
                    const details = document.querySelector(".recipe-details-modal");
                    const listItem = btn.closest(".tm-list-item");
                    const itemData = JSON.parse(listItem.getAttribute("data-item"));
                    document.querySelector(".recipe-details-image").src = `image/${itemData.image}`;
                    document.querySelector(".recipe-name").textContent = itemData.name;
                    const filters = document.querySelectorAll(".recipe-details-filters .filter");
                    filters[0].textContent = itemData.time;
                    filters[1].textContent = itemData.category;
                    document.querySelector(".recipe-ingredients p").textContent = itemData.material;
                    document.querySelector(".recipe-instructions p").textContent = itemData.recipe;
                    details.style.display = "block";
                    listItem.classList.add("active");
                });
            });

            // 상세 정보 모달 닫기 버튼 이벤트 리스너
            const closeModalBtn = document.querySelector(".recipe-details-close");
            closeModalBtn.addEventListener("click", function () {
                const details = document.querySelector(".recipe-details-modal");
                details.style.display = "none";
                document.querySelectorAll(".tm-list-item").forEach((item) => {
                    item.classList.remove("active");
                });
            });

            // 공유 버튼 이벤트 리스너
            const shareBtns = document.querySelectorAll(".share-btn");
            shareBtns.forEach((btn) => {
                btn.addEventListener("click", function (event) {
                    event.stopPropagation();
                    const shareModal = btn.nextElementSibling; // 다음 요소가 모달
                    shareModal.style.display = "block";
                });
            });

            const shareModal = document.getElementById("shareModal");
            const closeShareBtn = document.querySelector(".share-close");

            shareBtns.forEach((btn) => {
                btn.addEventListener("click", function (event) {
                    event.stopPropagation();
                    shareModal.style.display = "block";
                });
            });

            closeShareBtn.onclick = function () {
                shareModal.style.display = "none";
            };

            window.onclick = function (event) {
                if (event.target == shareModal) {
                    shareModal.style.display = "none";
                }
            };

            // 댓글 모달 
            const commentBtns = document.querySelectorAll(".comment-btn");

            commentBtns.forEach((btn) => {
                btn.addEventListener("click", function (event) {
                    event.stopPropagation();
                    const listItem = btn.closest(".tm-list-item");
                    const detailsModal = document.querySelector(".recipe-details-modal");
                    const commentsSection = detailsModal.querySelector(".comment-list");

                    // Create a temporary modal for comments
                    const commentListModal = document.createElement("div");
                    commentListModal.classList.add("comment-list-modal");
                    commentListModal.innerHTML = `
                        <div class="comment-list-content">
                            <span class="comment-list-close">&times;</span>
                            ${commentsSection.innerHTML}
                        </div>
                    `;
                    document.body.appendChild(commentListModal);
                    commentListModal.style.display = "block";

                    // Close button functionality
                    const closeBtn = commentListModal.querySelector(".comment-list-close");
                    closeBtn.addEventListener("click", function () {
                        commentListModal.style.display = "none";
                        document.body.removeChild(commentListModal);
                    });

                    // Close modal when clicking outside
                    window.addEventListener("click", function (event) {
                        if (event.target === commentListModal) {
                            commentListModal.style.display = "none";
                            document.body.removeChild(commentListModal);
                        }
                    });
                });
            });
        }
    </script>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            window.currentUser = null; // 전역 변수 선언

            // 로그인 처리 로직
            function handleLogin(event) {
                event.preventDefault(); // 기본 폼 제출 방지
                var username = document.getElementById("username").value;
                var password = document.getElementById("password").value;

                fetch('data/users.json')
                    .then(response => response.json())
                    .then(users => {
                        var user = users.find(user => user.username === username && user.password === password);
                        if (user) {
                            alert('로그인 성공!');
                            window.currentUser = user; // 로그인한 사용자 정보 저장
                            history.pushState(null, '', `/${username}`); // URL 변경

                            // 로그인 성공 시 버튼 변경
                            var navbarNav = document.querySelector(".navbar-nav");
                            var loginBtn = document.getElementById("loginBtn");

                            if (loginBtn) {
                                var welcomeMessage = document.createElement("li");
                                welcomeMessage.className = "nav-item";
                                welcomeMessage.innerHTML = `<a class="nav-link"> ${username}님, 환영합니다 </a>`;

                                var myPageButton = document.createElement("li");
                                myPageButton.className = "nav-item";
                                myPageButton.innerHTML = `<a class="nav-link" href="#" id="myPageBtn">마이페이지</a>`;

                                loginBtn.parentNode.replaceChild(welcomeMessage, loginBtn);
                                navbarNav.appendChild(myPageButton);

                                // 마이페이지 버튼 클릭 이벤트
                                myPageButton.addEventListener("click", showMyPage);

                                // 로그인 모달 닫기
                                var loginModal = document.getElementById("loginModal");
                                loginModal.style.display = "none";
                            }
                        } else {
                            alert('아이디 또는 비밀번호가 잘못되었습니다.');
                        }
                    })
                    .catch(error => console.error('Error:', error));
            }

            // 회원가입 모달 표시
            var registerLink = document.getElementById("registerLink");
            var registerModal = document.getElementById("registerModal");
            var closeRegisterBtn = document.querySelector(".close-register");

            // 로그인 모달 표시
            var loginBtn = document.getElementById("loginBtn");
            loginBtn.onclick = function () {
                var loginModal = document.getElementById("loginModal");
                loginModal.style.display = "block";
            };

            // 로그인 모달 닫기
            var closeLoginBtn = document.querySelector(".close");
            closeLoginBtn.onclick = function () {
                var loginModal = document.getElementById("loginModal");
                loginModal.style.display = "none";
            };

            // 회원가입 모달 표시
            registerLink.onclick = function (event) {
                event.preventDefault();
                var loginModal = document.getElementById("loginModal");
                loginModal.style.display = "none";
                registerModal.style.display = "block";
            };

            // 회원가입 모달 닫기
            closeRegisterBtn.onclick = function () {
                registerModal.style.display = "none";
            };

            // 회원가입 폼 제출 시 ID 중복 확인
            var registerForm = document.getElementById("registerForm");
            var warningModal = document.getElementById("warningModal");
            var warningText = document.getElementById("warning-text");
            var closeWarningBtn = document.querySelector(".warning-close");
            var successModal = document.getElementById("successModal");
            var closeSuccessBtn = document.querySelector(".success-close");

            registerForm.onsubmit = function (event) {
                event.preventDefault();
                var newUsername = document.getElementById("new-username").value;

                // 사용자 이름(ID) 중복 확인
                fetch('/check-username?username=' + newUsername)
                    .then(response => response.json())
                    .then(data => {
                        if (data.exists) {
                            // 경고 모달 표시
                            warningText.textContent = "이미 존재하는 ID입니다.";
                            warningModal.style.display = "block";
                        } else {
                            // 사용자 이름이 사용 가능하면 폼 제출
                            warningModal.style.display = "none";
                            successModal.style.display = "block";

                            // 2초 후에 성공 모달을 닫고 로그인 모달을 표시
                            setTimeout(function () {
                                successModal.style.display = "none";
                                registerModal.style.display = "none";
                                var loginModal = document.getElementById("loginModal");
                                loginModal.style.display = "block";
                            }, 2000);
                        }
                    })
                    .catch(error => console.error('Error:', error));
            };

            // 경고 모달 닫기 버튼
            closeWarningBtn.onclick = function () {
                warningModal.style.display = "none";
            };

            // 성공 모달 닫기 버튼
            closeSuccessBtn.onclick = function () {
                successModal.style.display = "none";
            };

            // 모달 외부 클릭 시 모달 닫기
            window.onclick = function (event) {
                var loginModal = document.getElementById("loginModal");
                var registerModal = document.getElementById("registerModal");
                var successModal = document.getElementById("successModal");
                var warningModal = document.getElementById("warningModal");
                if (event.target == loginModal) {
                    loginModal.style.display = "none";
                }
                if (event.target == registerModal) {
                    registerModal.style.display = "none";
                }
                if (event.target == successModal) {
                    successModal.style.display = "none";
                }
                if (event.target == warningModal) {
                    warningModal.style.display = "none";
                }
            };

            // 이벤트 리스너 설정
            document.getElementById("loginForm").addEventListener("submit", handleLogin);
        });
    </script>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // 마이페이지 표시
            function showMyPage(event) {
                event.preventDefault();
                if (!window.currentUser) return;

                var myPageModal = document.getElementById("myPageModal");
                document.getElementById("myPageUsername").textContent = `${window.currentUser.username}님의 마이페이지`;
                document.getElementById("userStudentId").textContent = window.currentUser.studentId;
                document.getElementById("userName").textContent = window.currentUser.name;
                document.getElementById("userId").textContent = window.currentUser.username;
                document.getElementById("userPassword").textContent = window.currentUser.password;

                // 등록한 레시피, 좋아요한 레시피, 내가 단 댓글 업데이트
                updateUserRecipes(window.currentUser);
                updateLikedRecipes(window.currentUser);
                updateUserComments(window.currentUser);

                myPageModal.style.display = "block";
            }

            // 등록한 레시피 업데이트
            function updateUserRecipes(user) {
                var userRecipeList = document.getElementById("userRecipeList");
                userRecipeList.innerHTML = ""; // 기존 내용 초기화
                if (user.recipes) {
                    user.recipes.forEach(recipe => {
                        var li = document.createElement("li");
                        li.textContent = recipe;
                        userRecipeList.appendChild(li);
                    });
                }
            }

            // 좋아요한 레시피 업데이트
            function updateLikedRecipes(user) {
                var likedRecipeList = document.getElementById("likedRecipeList");
                likedRecipeList.innerHTML = ""; // 기존 내용 초기화
                if (user.likedRecipes) {
                    user.likedRecipes.forEach(recipe => {
                        var li = document.createElement("li");
                        li.textContent = recipe;
                        likedRecipeList.appendChild(li);
                    });
                }
            }

            // 내가 단 댓글 업데이트
            function updateUserComments(user) {
                var userCommentList = document.getElementById("userCommentList");
                userCommentList.innerHTML = ""; // 기존 내용 초기화
                if (user.comments) {
                    user.comments.forEach(comment => {
                        var li = document.createElement("li");
                        li.textContent = comment;
                        userCommentList.appendChild(li);
                    });
                }
            }

            // 로그아웃 처리
            function handleLogout() {
                window.currentUser = null;
                alert('로그아웃 되었습니다.');
                location.reload(); // 페이지 새로고침하여 초기 상태로 되돌림
            }

            // 이벤트 리스너 설정
            document.getElementById("logoutBtn").addEventListener("click", handleLogout);

            // 모달 닫기 버튼
            var closeMyPageBtn = document.querySelector(".close-mypage");
            closeMyPageBtn.onclick = function () {
                var myPageModal = document.getElementById("myPageModal");
                myPageModal.style.display = "none";
            };

            // 모달 외부 클릭 시 모달 닫기
            window.onclick = function (event) {
                var myPageModal = document.getElementById("myPageModal");
                if (event.target == myPageModal) {
                    myPageModal.style.display = "none";
                }
            };

            // showMyPage 함수 정의
            window.showMyPage = showMyPage;
        });
    </script>
</body>
</html>
